<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üì¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® - MutodGrob</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <div class="card bg-dark text-white p-4 shadow">
            <div class="text-center">
                <img src="https://sv1.img.in.th/7iazJC.jpeg" class="img-fluid rounded-circle mx-auto d-block" alt="logo" style="max-width: 200px; height: auto;">
            </div>
            <h1 class="text-center mb-4">üì¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° üì¢</h1>
            <form action="/announce" method="post" onsubmit="handleSubmit(event)">
                <div class="mb-3">
                    <label>üåê ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</label>
                    <p class="mt-3 text-danger">‚ùó‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÄ‡∏ã‡∏¥‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡πÉ‡∏´‡πâ ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏´‡∏°‡πà</p>
                    <select class="form-control" id="guildSelect" name="guild_id" onchange="fetchChannelsAndMembers()" required></select>
                </div>
                <div class="mb-3">
                    <label>üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á</label>
                    <div id="channelsContainer"></div>
                </div>
                <div class="mb-3">
                    <label>üë• ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
                    <p class="mt-3 text-danger">‚ùó‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    <div id="membersContainer"></div>
                </div>
                <div class="mb-3">
                    <label>‚úèÔ∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <p class="mt-3 text-danger">‚ùó‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏™‡πà‡∏á‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏®‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÑ‡∏î‡πâ</p>
                    <input type="text" class="form-control" name="title" required>
                </div>
                <div class="mb-3">
                    <label>üìÑ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                    <p class="mt-3 text-danger">‚ùó‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ô‡∏ó‡∏±‡∏î‡πÑ‡∏î‡πâ ‡∏™‡πà‡∏á‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏®‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÑ‡∏î‡πâ</p>
                    <textarea class="form-control" name="message" rows="4" required></textarea>
                </div>
                <div class="mb-3">
                    <label>üñºÔ∏è URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="text" class="form-control" name="image_url">
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" name="tag_everyone" value="yes">
                    <label class="form-check-label">‡πÅ‡∏ó‡πá‡∏Å @everyone</label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="send_as_embed" id="embedCheck" value="yes" onchange="toggleColorPicker()">
                    <label class="form-check-label">‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô Embed</label>
                </div>
                <div class="mb-3" id="colorPicker" style="display: none;">
                    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ Embed</label>
                    <input type="color" class="form-control" name="color" value="#00ff00">
                </div>
                <button type="submit" class="btn btn-success w-100">üöÄ ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
            </form>
            <a href="/" class="btn btn-secondary w-100 mt-3">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </div>
        <p class="mt-3 text-danger">‚ùó‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡πÅ‡∏à‡πâ‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>
        <p class="mt-3">‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢: <a href="https://myyoomi.carrd.co/" class="text-info">‚Ñ¢MYYOOMI</a></p>
    </div>

    <script>
    async function fetchGuilds() {
        let response = await fetch('/guilds');
        let guilds = await response.json();
        let select = document.getElementById('guildSelect');
        select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</option>';
        guilds.forEach(guild => {
            let option = document.createElement('option');
            option.value = guild.id;
            option.textContent = guild.name;
            select.appendChild(option);
        });
    }
    async function fetchChannelsAndMembers() {
        let guildId = document.getElementById('guildSelect').value;
        if (!guildId) return;

        let channels = await (await fetch(`/channels?guild_id=${guildId}`)).json();
        let members = await (await fetch(`/members?guild_id=${guildId}`)).json();

        let channelContainer = document.getElementById('channelsContainer');
        let memberContainer = document.getElementById('membersContainer');

        channelContainer.innerHTML = '';
        channels.forEach(c => {
            channelContainer.innerHTML += `<div class="form-check"><input class="form-check-input" type="checkbox" name="channels" value="${c.id}"> ${c.name}</div>`;
        });

        memberContainer.innerHTML = '';
        members.forEach(m => {
            memberContainer.innerHTML += `<div class="form-check"><input class="form-check-input" type="checkbox" name="members" value="${m.id}"> ${m.name}</div>`;
        });
    }
    function toggleColorPicker() {
        const embedCheck = document.getElementById('embedCheck');
        const colorPicker = document.getElementById('colorPicker');
        colorPicker.style.display = embedCheck.checked ? 'block' : 'none';
    }
    async function handleSubmit(event) {
        event.preventDefault();
        let form = event.target;
        let formData = new FormData(form);
        let response = await fetch(form.action, {
            method: 'POST',
            body: formData
        });
        if (response.ok) {
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
            Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ', 'error');
        }
    }
    window.onload = function() {
        fetchGuilds();
        toggleColorPicker();
    }
    </script>
</body>
</html>